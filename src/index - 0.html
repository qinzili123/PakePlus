<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡è¯†åˆ«ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            min-height: 100vh;
            padding: 40px 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }

        .upload-container {
            display: flex;
            justify-content: center;
            flex-wrap: nowrap;
        }

        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 400px;
            transition: transform 0.3s ease;
        }

        .upload-section:hover {
            transform: translateY(-5px);
        }

        .drop-zone {
            width: 100%;
            height: 240px;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #fafafa;
            margin-bottom: 20px;
        }

        .drop-zone#dropZone1:before {
            content: 'ğŸ“„';
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .drop-zone#dropZone2:before {
            content: 'ğŸ†”';
            font-size: 40px;
            margin-bottom: 10px;
        }

        .drop-zone.dragover {
            border-color: #3498db;
            background-color: #ecf0f1;
        }

        .drop-zone-text {
            color: #7f8c8d;
            font-size: 16px;
            text-align: center;
        }

        .loading {
            position: relative;
            color: transparent !important;
        }

        .loading::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid #3498db;
            border-radius: 50%;
            border-right-color: transparent;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            from {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .result {
            position: relative;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            min-height: 120px;
            font-size: 14px;
            line-height: 1.6;
            color: #2c3e50;
            word-break: break-all;
            border: 1px solid #e9ecef;
        }

        .result:empty::before {
            content: 'ç­‰å¾…ä¸Šä¼ å›¾ç‰‡...';
            color: #95a5a6;
            font-style: italic;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        @media (max-width: 768px) {
            .upload-section {
                width: 100%;
                margin: 0 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .drop-zone {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="upload-container">
            <div class="upload-section">
                <div class="drop-zone" id="dropZone1">
                    <div class="drop-zone-text">
                        æ‹–æ‹½åˆæ ¼è¯å›¾ç‰‡è¿›è¡Œè¯†åˆ«
                    </div>
                </div>
            </div>
            
            <div class="upload-section">
                <div class="drop-zone" id="dropZone2">
                    <div class="drop-zone-text">
                        æ‹–æ‹½èº«ä»½è¯å›¾ç‰‡è¿›è¡Œè¯†åˆ«
                    </div>
                </div>
            </div>
    </div>

    <script>
        // æ·»åŠ å…¨å±€å˜é‡å­˜å‚¨è¯†åˆ«ç»“æœ
        let certificateResult = null;  // å­˜å‚¨åˆæ ¼è¯è¯†åˆ«ç»“æœ
        let idCardResult = null;      // å­˜å‚¨èº«ä»½è¯è¯†åˆ«ç»“æœ

        function initDropZone(dropZoneId, resultId) {
            const dropZone = document.getElementById(dropZoneId);
            const resultDiv = document.getElementById(resultId);

            // é˜»æ­¢é»˜è®¤æ‹–æ‹½è¡Œä¸º
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // æ·»åŠ æ‹–æ‹½æ•ˆæœ
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => highlight(dropZone), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => unhighlight(dropZone), false);
            });

            // å¤„ç†å›¾ç‰‡æ‹–æ”¾
            dropZone.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                // ä¼ å…¥dropZoneIdæ¥åŒºåˆ†ä¸åŒçš„æ‹–æ‹½åŒºåŸŸ
                handleFiles(files, resultDiv, dropZoneId);
            }, false);
        }

        function highlight(dropZone) {
            dropZone.classList.add('dragover');
        }

        function unhighlight(dropZone) {
            dropZone.classList.remove('dragover');
        }

        // ä¿®æ”¹handleFileså‡½æ•°ï¼Œç§»é™¤ç»“æœæ˜¾ç¤ºç›¸å…³ä»£ç 
        function handleFiles(files, resultDiv, dropZoneId) {
            const file = files[0];
            if (file && file.type.startsWith('image/')) {
                const dropZone = document.getElementById(dropZoneId);
                const dropZoneText = dropZone.querySelector('.drop-zone-text');
                dropZoneText.classList.add('loading');
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const cleanBase64 = e.target.result.replace(/^data:image\/\w+;base64,/, '');
                    
                    // fetch('http://127.0.0.1:1224/api/ocr'
                    fetch('http://localhost/shitu/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: 'base64_image=' + encodeURIComponent(cleanBase64)
                        // "base64": cleanBase64,
                        // "options": {
                        //     "tbpu.parser": "multi_none",
                        //     "data.format": "text"
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(data => {
                        // åªå­˜å‚¨è¯†åˆ«ç»“æœåˆ°å¯¹åº”å˜é‡ï¼Œä¸å†æ˜¾ç¤ºç»“æœ
                        if (dropZoneId === 'dropZone1') {
                            certificateResult = data;
                            //å¤„ç†åˆæ ¼è¯è¯†åˆ«ç»“æœ

                            //æå–åˆæ ¼è¯ç¼–å·ï¼ˆæˆªå–â€œåˆæ ¼è¯ç¼–å·â€ä¸â€œ2.â€ä¹‹é—´çš„å†…å®¹ï¼‰å¹¶ç§»é™¤ç©ºæ ¼
                            const certificateNumber = data.substring(data.indexOf("åˆæ ¼è¯ç¼–å·")+5, data.indexOf("2.")).trim();
                            console.log("åˆæ ¼è¯ç¼–å·(certificateNumber)ï¼š"+certificateNumber);
                            
                            //æå–å“ç‰Œ_ç±»å‹ï¼ˆæˆªå–â€œåˆæ ¼è¯ç¼–å·â€ä¸â€œ2.â€ä¹‹é—´çš„å†…å®¹ï¼‰å¹¶ç§»é™¤ä¸¤è¾¹ç©ºæ ¼
                            const brand_type = data.substring(data.indexOf("è½¦è¾†åç§°")+4, data.indexOf("5.")).trim();
                            //ç©ºæ ¼åˆ†å‰²brand_typeä¸ºå“ç‰Œå’Œç±»å‹
                            const brand_type_array = brand_type.split(" ");
                            const brand = brand_type_array[0];
                            const type = brand_type_array[1];
                            console.log("å“ç‰Œ(brand)ï¼š"+brand);
                            console.log("ç±»å‹(type)ï¼š"+type);
                            
                            //æå–è½¦è¾†å‹å·ï¼ˆæˆªå–â€œå‹å·â€ä¸â€œ6.â€ä¹‹é—´çš„å†…å®¹ï¼‰å¹¶ç§»é™¤ä¸¤è¾¹ç©ºæ ¼
                            const vehicleModel = data.substring(data.indexOf("å‹å·")+2, data.indexOf("6.")).trim();
                            console.log("è½¦è¾†å‹å·(vehicleModel)ï¼š"+vehicleModel);

                            const brand_vehicleModel=brand+" "+vehicleModel;

                            //æå–å‘åŠ¨æœºå‹å·ï¼ˆæˆªå–â€œå‘åŠ¨æœºå‹å·â€ä¸â€œ7.â€ä¹‹é—´çš„å†…å®¹ï¼‰å¹¶ç§»é™¤ä¸¤è¾¹ç©ºæ ¼
                            const engineModel = data.substring(data.indexOf("å‘åŠ¨æœºå·")+4, data.indexOf("12.")).trim();
                            console.log("å‘åŠ¨æœºå‹å·(engineModel)ï¼š"+engineModel);
                            
                            //æå–è½¦æ¶å·ï¼ˆæˆªå–â€œ6.â€ä¸â€œ7.â€ä¹‹é—´çš„å­—æ¯å’Œæ•°å­—éƒ¨åˆ†ï¼Œç§»é™¤æ±‰å­—éƒ¨åˆ†å’Œå…¶ä»–å­—ç¬¦ï¼‰å¹¶ç§»é™¤ä¸¤è¾¹ç©ºæ ¼
                            const vehicleFrameNumber = data.substring(data.indexOf("6.")+2, data.indexOf("7.")).replace(/[\u4e00-\u9fa5]/g, '').replace(/[^a-zA-Z0-9]/g, '').trim();
                            console.log("è½¦æ¶å·(vehicleFrameNumber)ï¼š"+vehicleFrameNumber);

                            //æå–å¨ä½ï¼ˆæˆªå–â€œ28.â€ä¸â€œ29.â€ä¹‹é—´çš„æ•°å­—éƒ¨åˆ†ï¼Œç§»é™¤æ±‰å­—éƒ¨åˆ†å’Œå…¶ä»–å­—ç¬¦ï¼‰å¹¶ç§»é™¤ä¸¤è¾¹ç©ºæ ¼,è½¬æ¢ä¸ºæ•°å­—
                            var tonnage = (data.substring(data.indexOf("28.")+3, data.indexOf("29.")).replace(/[\u4e00-\u9fa5]/g, '').replace(/[^0-9]/g, '').trim())/1000;
                            if(tonnage == 0){
                                tonnage = "-";
                            }
                            console.log("å¨ä½(tonnage)ï¼š"+tonnage);


                            //æå–è½½å®¢é‡ï¼ˆæˆªå–â€œ33.â€ä¸â€œ34.â€ä¹‹é—´çš„æ•°å­—éƒ¨åˆ†ï¼Œç§»é™¤æ±‰å­—éƒ¨åˆ†å’Œå…¶ä»–å­—ç¬¦ï¼‰å¹¶ç§»é™¤ä¸¤è¾¹ç©ºæ ¼,è½¬æ¢ä¸ºæ•°å­—
                            var passengerCapacity = data.substring(data.indexOf("33.")+3, data.indexOf("34.")).replace(/[\u4e00-\u9fa5]/g, '').replace(/[^0-9]/g, '').trim()*1;
                            
                            if(passengerCapacity == 0){
                                passengerCapacity = data.substring(data.indexOf("32.")+3, data.indexOf("33.")).replace(/[\u4e00-\u9fa5]/g, '').replace(/[^0-9]/g, '').trim()*1;
                            }
                            console.log("è½½å®¢é‡(passengerCapacity)ï¼š"+passengerCapacity);


                            //æå–ç”Ÿäº§åœ°å€ï¼ˆæˆªå–â€œå•ä½åœ°å€ï¼šâ€ä¸â€œçœâ€ä¹‹é—´çš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰â€œçœâ€åˆ™æˆªå–â€œå•ä½åœ°å€ï¼šâ€ä¸â€œå¸‚â€ä¹‹é—´çš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰â€å¸‚â€œåˆ™æå–"å•ä½åœ°å€ï¼š"åé¢çš„ä¸¤ä¸ªæ±‰å­—ï¼‰å¹¶ç§»é™¤ä¸¤è¾¹ç©ºæ ¼
                            var productionAddress = data.substring(data.indexOf("å•ä½åœ°å€ï¼š")+5, data.indexOf("çœ")).trim();
                            //å¦‚æœproductionAddressä¸ºç©ºè·å–é•¿åº¦å¤§äº10çš„åœ°å€
                            if(productionAddress == "" || productionAddress.length > 10){
                                productionAddress = data.substring(data.indexOf("å•ä½åœ°å€ï¼š")+5, data.indexOf("å¸‚")).trim();
                            }
                            if(productionAddress == ""|| productionAddress.length > 10){
                                productionAddress = data.substring(data.indexOf("å•ä½åœ°å€ï¼š")+5, data.indexOf("å•ä½åœ°å€ï¼š")+7).trim();
                            }
                            console.log("ç”Ÿäº§åœ°å€(productionAddress)ï¼š"+productionAddress);

                            //å°†æå–åˆ°çš„æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°å¹¶æ›´æ–°è¡¨å•
                            localStorage.setItem("certificateNumber", certificateNumber);
                            document.getElementById('certificateNumber').value = certificateNumber;
                            localStorage.setItem("brand_vehicleModel", brand_vehicleModel);
                            document.getElementById('brand_vehicleModel').value = brand_vehicleModel;
                            localStorage.setItem("type", type);
                            document.getElementById('type').value = type;
                            localStorage.setItem("engineModel", engineModel);
                            document.getElementById('engineModel').value = engineModel;
                            localStorage.setItem("vehicleFrameNumber", vehicleFrameNumber);
                            document.getElementById('vehicleFrameNumber').value = vehicleFrameNumber;
                            localStorage.setItem("tonnage", tonnage);
                            document.getElementById('tonnage').value = tonnage;
                            localStorage.setItem("passengerCapacity", passengerCapacity);
                            document.getElementById('passengerCapacity').value = passengerCapacity;
                            localStorage.setItem("productionAddress", productionAddress);
                            document.getElementById('productionAddress').value = productionAddress;
                            

                        } else if (dropZoneId === 'dropZone2') {
                            idCardResult = data;
                            //å¤„ç†èº«ä»½è¯è¯†åˆ«ç»“æœ
                            //æå–å§“å
                            const name = data.substring(data.indexOf("å§“å")+2, data.indexOf("æ€§åˆ«")).trim();
                            console.log("å§“å(name)ï¼š"+name);

                            //æå–æ€§åˆ«
                            const gender = data.substring(data.indexOf("æ€§åˆ«")+2, data.indexOf("æ°‘æ—")).trim();
                            console.log("æ€§åˆ«(gender)ï¼š"+gender);

                            //æå–æ°‘æ—
                            const nationality = data.substring(data.indexOf("æ°‘æ—")+2, data.indexOf("å‡ºç”Ÿ")).trim();
                            console.log("æ°‘æ—(nationality)ï¼š"+nationality);

                            //æå–ä½å€
                            const address = data.substring(data.indexOf("å€")+1, data.indexOf("å…¬æ°‘")).trim();
                            console.log("ä½å€(address)ï¼š"+address);

                            //æå–å…¬æ°‘èº«ä»½è¯å·ç 
                            const idCardNumber = data.substring(data.indexOf("å·ç ")+2, data.indexOf("å·ç ")+21).trim();
                            console.log("å…¬æ°‘èº«ä»½è¯å·ç (idCardNumber)ï¼š"+idCardNumber);
                            
                            //å°†æå–åˆ°çš„æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°å¹¶æ›´æ–°è¡¨å•
                            localStorage.setItem("name", name);
                            document.getElementById('name').value = name;
                            localStorage.setItem("gender", gender);
                            document.getElementById('gender').value = gender;
                            localStorage.setItem("nationality", nationality);
                            document.getElementById('nationality').value = nationality;
                            localStorage.setItem("address", address);
                            document.getElementById('address').value = address;
                            localStorage.setItem("idCardNumber", idCardNumber);
                            document.getElementById('idCardNumber').value = idCardNumber;



                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // å‘ç”Ÿé”™è¯¯æ—¶æ¸…ç©ºå¯¹åº”çš„ç»“æœ
                        if (dropZoneId === 'dropZone1') {
                            certificateResult = null;
                        } else if (dropZoneId === 'dropZone2') {
                            idCardResult = null;
                        }
                    })
                    .finally(() => {
                        dropZoneText.classList.remove('loading');
                    });
                };

                reader.readAsDataURL(file);
            }
        }

        // åˆå§‹åŒ–ä¸¤ä¸ªæ‹–æ‹½åŒºåŸŸ
        initDropZone('dropZone1', 'result1');
        initDropZone('dropZone2', 'result2');
        

       
    </script>
     <!-- ç»“æœå±•ç¤ºè¡¨å• -->
     <div class="result-form">
        <div class="form-section">
                <div class="form-row">
                    <label>åˆæ ¼è¯ç¼–å·:</label>
                    <input type="text" id="certificateNumber" >
                </div>
                <div class="form-row">
                    <label>å“ç‰Œå‹å·:</label>
                    <input type="text" id="brand_vehicleModel" >
                </div>
                <div class="form-row">
                    <label>ç±»å‹:</label>
                    <input type="text" id="type" >
                </div>
                <div class="form-row">
                    <label>å‘åŠ¨æœºå‹å·:</label>
                    <input type="text" id="engineModel" >
                </div>
                <div class="form-row">
                    <label>è½¦æ¶å·:</label>
                    <input type="text" id="vehicleFrameNumber" >
                </div>
                <div class="form-row">
                    <label>å¨ä½:</label>
                    <input type="text" id="tonnage" >
                </div>
                <div class="form-row">
                    <label>è½½å®¢é‡:</label>
                    <input type="text" id="passengerCapacity" >
                </div>
                <div class="form-row">
                    <label>ç”Ÿäº§åœ°å€:</label>
                    <input type="text" id="productionAddress" >
                </div>

                <div class="form-row">
                    <label>å§“å:</label>
                    <input type="text" id="name" >
                </div>
                <div class="form-row">
                    <label>æ€§åˆ«:</label>
                    <input type="text" id="gender" >
                </div>
                <div class="form-row">
                    <label>æ°‘æ—:</label>
                    <input type="text" id="nationality" >
                </div>
                <div class="form-row">
                    <label>èº«ä»½è¯å·ç :</label>
                    <input type="text" id="idCardNumber" >
                </div>
                <div class="form-row" style="width: 100%;">
                    <label>ä½å€:</label>
                    <input type="text" id="address" >
                </div>
                <div class="form-row">
                    <label>å‘ç¥¨åœ°åŒº:</label>
                    <input type="text" id="invoiceArea" onblur="refreshCompany()">
                        
                </div>
                <div class="form-row" onclick="refreshCompany()">
                    <label>å…¬å¸åç§°:</label>
                    <input type="text" id="companyName" disabled >
                </div>
                <div class="form-row">
                    <label>èƒŒæ™¯æ•°é‡:</label>
                    <input type="text" id="backgroundNumber" onload="getBackgroundCount()">
                </div>
                <div class="form-row">
                    <label>å‘ç¥¨é‡‘é¢:</label>
                    <input type="text" id="invoiceAmount" onkeyup="invoice(this.value)">
                </div>
                <div class="form-row">
                    <label>å¤§å†™é‡‘é¢:</label>
                    <input type="text" id="invoiceAmountInChinese" >
                </div>
                <div class="form-row">
                    <label>å°å†™é‡‘é¢:</label>
                    <input type="text" id="invoiceAmountInDigits" >
                </div>
                <div class="form-row">
                    <label>å¢å€¼ç¨é¢:</label>
                    <input type="text" id="vatAmount" >
                </div>
                <div class="form-row">
                    <label>ä¸å«ç¨é¢:</label>
                    <input type="text" id="taxExcludedAmount" >
                </div>
            </div>
    </div>

    <div class="form-actions" style="text-align: center; margin-top: 20px;">
        <button id="applyInfoBtn" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">åº”ç”¨ä¿¡æ¯</button>
    </div>

    <style>
        .result-form {
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .result-form h2 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .result-form h3 {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }
        
        .form-section {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: space-between;
        }
        
        .form-row {
            display: flex;
            flex-grow: 1;
            min-width: 200px;
            max-width: 100%;
            margin-bottom: 8px;
            align-items: center;
        }

        .form-row label {
            min-width: 80px;
            font-weight: bold;
            color: #2c3e50;
            margin-right: 10px;
            align-self: center;
        }

        .form-row input {
            flex: 1;
            min-width: 120px;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        document.getElementById('applyInfoBtn').addEventListener('click', function() {
            // è·å–æ‰€æœ‰è¡¨å•è¾“å…¥æ¡†çš„å€¼å¹¶æ›´æ–°åˆ°localStorage
            const inputs = document.querySelectorAll('.result-form .form-section .form-row input');
            inputs.forEach(input => {
                localStorage.setItem(input.id, input.value);
            });
           //æ§åˆ¶å°æ‰“å°localStorage
            console.log(localStorage);
        });
        //å®Œå–„refreshCompanyï¼ˆï¼‰
        function refreshCompany() {
            //è·å–invoiceAreaçš„å€¼
            const invoiceArea = document.getElementById('invoiceArea').value;
            //å¦‚æœinvoiceAreaçš„å€¼ä¸ºç©ºï¼Œåˆ™ä¸å‘é€è¯·æ±‚
            if (!invoiceArea) {
                return;
            }

            //æ ¹æ®invoiceAreaçš„å€¼è·å–å‘http://localhost/shitu/refreshCompany.phpå‘é€getè¯·æ±‚
            fetch('http://localhost/shitu/refreshCompany.php?invoiceArea='+invoiceArea)
            .then(response => response.json())
            .then(data => {
                //å°†dataæ•°æ®æ‰€æœ‰å­—æ®µä¿å­˜åˆ°localStorage
                Object.keys(data).forEach(key => {
                    localStorage.setItem(key, data[key]);
                });
                //å°†dataä¸­çš„companyNameèµ‹å€¼ç»™document.getElementById('companyName').value
                document.getElementById('companyName').value = data.gongsimingcheng;

            })
            .catch(error => console.error('Error:', error));
        }

        //è·å–èƒŒæ™¯æ•°é‡ï¼Œå¹¶èµ‹å€¼ç»™èƒŒæ™¯æ•°é‡è¾“å…¥æ¡†ï¼Œé¡µé¢åŠ è½½æ—¶è°ƒç”¨
        window.onload = function() {
            getBackgroundCount();
        }
        function getBackgroundCount() {
            //ä»localStorageä¸­è·å–backgroundCountï¼Œèµ‹å€¼ç»™èƒŒæ™¯æ•°é‡è¾“å…¥æ¡†ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›1
            
            const backgroundCount = localStorage.getItem('backgroundNumber') || 1;
            document.getElementById('backgroundNumber').value = backgroundCount;
        }
        

        //è½¬æ¢å¤§å†™é‡‘é¢
        function digitUppercase(n) {
            var fraction = ['è§’', 'åˆ†'];
            var digit = [
                'é›¶', 'å£¹', 'è´°', 'å', 'è‚†',
                'ä¼', 'é™†', 'æŸ’', 'æŒ', 'ç–'
            ];
            var unit = [
                ['åœ†', 'ä¸‡', 'äº¿'],
                ['', 'æ‹¾', 'ä½°', 'ä»Ÿ']
            ];
            var IsNum = Number(n);
            if (!isNaN(IsNum)) {
                var head = n < 0 ? 'æ¬ ' : '';
                n = Math.abs(n);
                var s = '';
                for (var i = 0; i < fraction.length; i++) {
                    s += (digit[Math.floor(n * 100/10 * Math.pow(10, i)) % 10] + fraction[i]).replace(/é›¶./, '');
                }
                s = s || 'æ•´';
                n = Math.floor(n);
                for (var i = 0; i < unit[0].length && n > 0; i++) {
                    var p = '';
                    for (var j = 0; j < unit[1].length && n > 0; j++) {
                        p = digit[n % 10] + unit[1][j] + p;
                        n = Math.floor(n / 10);
                    }
                    s = p.replace(/(é›¶.)*é›¶$/, '').replace(/^$/, 'é›¶') + unit[0][i] + s;
                }
                return head + s.replace(/(é›¶.)*é›¶åœ†/, 'åœ†')
                    .replace(/(é›¶.)+/g, 'é›¶')
                    .replace(/^æ•´$/, 'é›¶åœ†æ•´');
            }
            else {
                return "";
            }
        };

        //å®Œå–„invoice
        function invoice(invoice) {

            //å¦‚æœinvoiceçš„å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›ç©º
            if (!invoice) {
                return;
            }

            invoice=invoice*1;
            //å°†invoiceçš„å€¼è½¬æ¢ä¸ºå¤§å†™é‡‘é¢
            var invoiceAmountInChinese = digitUppercase(invoice);
            //å¤§å†™é‡‘é¢
            document.getElementById('invoiceAmountInChinese').value = invoiceAmountInChinese;
            //å°å†™é‡‘é¢(ä¿ç•™ä¸¤ä½å°æ•°)
            document.getElementById('invoiceAmountInDigits').value = invoice.toFixed(2);
            //å¢å€¼ç¨é¢
            document.getElementById('vatAmount').value = (invoice.toFixed(2)-(invoice/1.13).toFixed(2)).toFixed(2);
            //ä¸å«ç¨é¢
            document.getElementById('taxExcludedAmount').value = (invoice/1.13).toFixed(2);
        }

        
    </script>

</body>
</html>